@ECHO OFF

IF NOT EXIST ENV.BAT GOTO :ERR_CREATE_ENVBAT

CALL ENV.BAT

:INIT
SET OUT_DIR=%ROOT_DIR%\OUT
SET SRC_DIR=%ROOT_DIR%\SOURCE
SET COMPILE=TPC
REM SET UNITS_DIRS=C:\BP\UNITS
SET FLAGS=-L -M -E%OUT_DIR% -I%SRC_DIR% -U%UNITS_DIRS% -O%OUT_DIR%
ECHO ------------------------------
ECHO Using variables:
SET
ECHO ==============================
PAUSE

:CLEAN
ECHO CLEANING UP OUTPUT DIRECTORY ...
DEL /Q %OUT_DIR%\*.EXE
DEL /Q %OUT_DIR%\*.OVR

ECHO.

REM ECHO COPYING BPC.CFG TO BP DIRECTORY ...
REM COPY C:\RGSRC\BPC.CFG C:\BP\BIN

:BUILD_RGUPDATE
ECHO.
ECHO COMPILING RGUPDATE
CD %SRC_DIR%
%COMPILE% %FLAGS% RGUPDATE.PAS
IF NOT ERRORLEVEL==0 GOTO ERR_END
CD %ROOT_DIR%

:BUILD_RENEGADE
ECHO.
ECHO COMPILING RENEGADE.EXE
CD %SRC_DIR%
ECHO Using flags '%FLAGS%'
%COMPILE% %FLAGS% RENEGADE.PAS
ECHO '%ERRORLEVEL%
PAUSE
IF NOT ERRORLEVEL==0 GOTO ERR_END
CD %ROOT_DIR%

:BUILD_RENEMAIL
ECHO.
ECHO COMPILING RENEMAIL.EXE
CD %SRC_DIR%
%COMPILE% %FLAGS% RENEMAIL.PAS
IF NOT ERRORLEVEL==0 GOTO ERR_END
CD %ROOT_DIR%


:BUILD_RGLNG
ECHO.
ECHO COMPILING RGLNG.EXE
CD %SRC_DIR%
%COMPILE% %FLAGS% RGLNG.PAS
IF NOT ERRORLEVEL==0 GOTO ERR_END
CD %ROOT_DIR%

:COMPILE_RGQUOTE
ECHO.
ECHO COMPILING RGQUOTE.EXE
CD %SRC_DIR%
%COMPILE% %FLAGS% RGQUOTE.PAS
IF NOT ERRORLEVEL==0 GOTO ERR_END
CD %ROOT_DIR%

:COMPILE_TAGLINE
ECHO.
ECHO COMPILING TAGLINE.EXE
CD %SRC_DIR%
%COMPILE% %FLAGS% TAGLINE.PAS
IF NOT ERRORLEVEL==0 GOTO ERR_END
CD %ROOT_DIR%

ECHO.
ECHO BUILD COMPLETE!
ECHO.

:COPY_OUTPUT
ECHO COPYING EXECUTABLES TO RENEGADE PATH %RG_DIR%
CD %ROOT_DIR%

ECHO COPYING RENEGADE.EXE ...
COPY %OUT_DIR%\RENEGADE.EXE %RG_DIR%
ECHO COPYING RENEGADE.OVR ...
COPY %OUT_DIR%\RENEGADE.OVR %RG_DIR%
ECHO COPYING RENEMAIL.EXE ...
COPY %OUT_DIR%\RENEMAIL.EXE %RG_DIR%
ECHO COPYING RGLNG.EXE ...
COPY %OUT_DIR%\RGLNG.EXE %RG_DIR%\TEXT\
ECHO COPYING RGQUOTE.EXE ...
COPY %OUT_DIR%\RGQUOTE.EXE %RG_DIR%\TEXT\
ECHO COPYING TAGLINE.EXE ...
COPY %OUT_DIR%\TAGLINE.EXE %RG_DIR%\TEXT\
ECHO COPYING RGUPDATE.EXE ...
COPY %OUT_DIR%\RGUPDATE.EXE %RG_DIR%

GOTO END


:ERR_END
CD %ROOT_DIR%
ECHO ERROR!
REM EXIT

:LOAD_ENV
ECHO in load_env
CALL ENV.BAT
ECHO VALUE '%HERE%'
GOTO :INIT

:ERR_CREATE_ENV_VAR
ECHO ERROR: No ENV.BAT present
ECHO Please see README.TXT for instructions
REM EXIT

:END
CD %ROOT_DIR%
ECHO DONE.
PAUSE
REM EXIT
